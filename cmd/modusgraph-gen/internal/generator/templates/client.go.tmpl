package {{.Name}}

import (
	"context"

	"github.com/matthewmcneely/modusgraph"
)

// Client provides typed access to the {{.Name}} data model.
type Client struct {
	conn modusgraph.Client
{{- range .Entities}}
	{{.Name}} *{{.Name}}Client
{{- end}}
}

// New creates a new Client connected to the graph database at connStr.
func New(connStr string, opts ...modusgraph.ClientOpt) (*Client, error) {
	conn, err := modusgraph.NewClient(connStr, opts...)
	if err != nil {
		return nil, err
	}
	return NewFromClient(conn), nil
}

// NewFromClient creates a new Client from an existing modusgraph.Client connection.
func NewFromClient(conn modusgraph.Client) *Client {
	return &Client{
		conn: conn,
{{- range .Entities}}
		{{.Name}}: &{{.Name}}Client{conn: conn},
{{- end}}
	}
}

// QueryRaw executes a raw DQL query against the database.
// The query parameter is the Dgraph query string (DQL syntax).
// The vars parameter is an optional map of variable names to values for parameterized queries.
func (c *Client) QueryRaw(ctx context.Context, query string, vars map[string]string) ([]byte, error) {
	return c.conn.QueryRaw(ctx, query, vars)
}

// Close releases all resources used by the client.
func (c *Client) Close() {
	c.conn.Close()
}
